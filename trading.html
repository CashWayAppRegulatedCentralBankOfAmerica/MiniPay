<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NovaFX Trading</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-[#1a1a2e] text-white p-4 font-sans">
  <div class="max-w-xl mx-auto space-y-6">
    <div class="flex justify-between items-center">
      <h1 class="text-2xl font-bold">Trade Market</h1>
      <a href="dashboard.html" class="text-sm text-blue-400 underline">Dashboard</a>
    </div>

    <div>
      <label for="pair" class="block mb-1">Select Pair</label>
      <select id="pair" class="w-full p-2 rounded bg-gray-800">
        <option value="EUR/USD">EUR/USD</option>
        <option value="GBP/USD">GBP/USD</option>
        <option value="USD/JPY">USD/JPY</option>
        <option value="USD/KES">USD/KES</option>
        <option value="AUD/USD">AUD/USD</option>
        <option value="USD/CHF">USD/CHF</option>
        <option value="NZD/USD">NZD/USD</option>
        <option value="EUR/JPY">EUR/JPY</option>
        <option value="GBP/JPY">GBP/JPY</option>
        <option value="USD/CAD">USD/CAD</option>
        <option value="XAU/USD">XAU/USD (Gold)</option>
      </select>
    </div>

    <div id="chart" class="w-full h-64"></div>

    <form id="trade-form" class="space-y-4">
      <div>
        <input type="number" step="0.01" id="lot" placeholder="Lot Size (min 0.01)" class="w-full p-2 bg-gray-800 rounded">
      </div>
      <div>
        <input type="number" id="sl" placeholder="Stop Loss" class="w-full p-2 bg-gray-800 rounded">
      </div>
      <div>
        <input type="number" id="tp" placeholder="Take Profit" class="w-full p-2 bg-gray-800 rounded">
      </div>
      <div class="grid grid-cols-2 gap-2">
        <button type="button" onclick="executeTrade('buy')" class="bg-green-600 py-2 rounded">Buy</button>
        <button type="button" onclick="executeTrade('sell')" class="bg-red-600 py-2 rounded">Sell</button>
      </div>
    </form>

    <a href="history.html" class="block text-center mt-4 text-blue-300 underline">View Trade History</a>
  </div>

  <script>
    let market = {};
    const pairSelect = document.getElementById('pair');
    const lotInput = document.getElementById('lot');
    const slInput = document.getElementById('sl');
    const tpInput = document.getElementById('tp');

    let account = JSON.parse(localStorage.getItem("account")) || {balance: 1000, equity: 1000, usedMargin: 0, pnl: 0, trades: [], history: []};

    function updateMarket() {
      const pair = pairSelect.value;
      if (!market[pair]) market[pair] = 1 + Math.random();
      const change = (Math.random() - 0.5) * 0.01;
      market[pair] += change;
      market[pair] = parseFloat(market[pair].toFixed(5));
      slInput.value = (market[pair] - 0.01).toFixed(5);
      tpInput.value = (market[pair] + 0.01).toFixed(5);
    }

    pairSelect.addEventListener('change', updateMarket);
    setInterval(updateMarket, 2000);
    updateMarket();

    function executeTrade(type) {
      const pair = pairSelect.value;
      const lot = parseFloat(lotInput.value);
      const sl = parseFloat(slInput.value);
      const tp = parseFloat(tpInput.value);
      const price = market[pair];

      if (!lot || lot < 0.01) return alert("Invalid lot size. Minimum is 0.01");
      if ((type === 'buy' && (sl >= price || tp <= price)) || (type === 'sell' && (sl <= price || tp >= price))) {
        return alert("Invalid SL/TP values for trade direction.");
      }
      if (account.freeMargin < lot * 100) return alert("Insufficient funds.");

      account.usedMargin += lot * 100;
      account.trades.push({pair, lot, type, openPrice: price, sl, tp});
      localStorage.setItem("account", JSON.stringify(account));
      alert("Trade opened: " + type.toUpperCase() + " " + pair);
    }
  </script>
</body>
</html>
