<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#1a1a2e" />
  <title>Forex Wallet Platform</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-[#1a1a2e] text-white font-sans antialiased">
  <div class="w-full max-w-sm mx-auto mt-4 p-4 space-y-4">

    <!-- Wallet Section -->
    <div class="bg-green-600 rounded-2xl p-4">
      <div class="flex justify-between items-center mb-2">
        <h2 id="balance" class="text-2xl font-bold">$1000.00</h2>
        <div class="flex items-center space-x-2">
          <span class="text-xs text-white">USD</span>
          <label class="relative inline-flex items-center cursor-pointer">
            <input type="checkbox" value="" class="sr-only peer">
            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-green-300 rounded-full peer peer-checked:bg-green-500"></div>
          </label>
          <span class="text-xs text-white">KES</span>
        </div>
      </div>
      <div class="grid grid-cols-2 gap-4">
        <button class="bg-green-700 py-2 rounded-xl text-white font-semibold">Add Cash</button>
        <button class="bg-green-700 py-2 rounded-xl text-white font-semibold">Withdraw</button>
      </div>
    </div>

    <!-- Offer -->
    <div class="bg-blue-600 rounded-2xl p-4">
      <h3 class="text-lg font-semibold mb-2">You're almost there!</h3>
      <p class="text-sm mb-3">Get up to $0.25 back on your first add cash transaction. Earn 2% weekly on your savings.</p>
      <button class="bg-blue-800 w-full py-2 rounded-xl text-white font-semibold">Add Cash</button>
    </div>

    <!-- Trade Controls -->
    <div class="bg-gray-800 rounded-2xl p-4 space-y-2">
      <h3 class="text-lg font-semibold">Trade Forex</h3>
      <select class="w-full bg-gray-700 text-white p-2 rounded-xl">
        <option>EUR/USD</option>
        <option>GBP/USD</option>
        <option>USD/JPY</option>
        <option>USD/KES</option>
      </select>
      <input type="number" placeholder="Lot size (e.g. 0.1)" class="w-full bg-gray-700 p-2 rounded-xl text-white">
      <div class="flex gap-4 mt-2">
        <button class="bg-green-600 flex-1 py-2 rounded-xl text-white font-semibold">Buy</button>
        <button class="bg-red-600 flex-1 py-2 rounded-xl text-white font-semibold">Sell</button>
      </div>
    </div>

    <!-- Market Prices -->
    <div class="bg-gray-800 rounded-2xl p-4">
      <h3 class="text-lg font-semibold mb-2">Live Market Prices</h3>
      <div class="space-y-2 text-sm">
        <div class="flex justify-between"><span>EUR/USD</span><span data-market="EUR/USD">--</span></div>
        <div class="flex justify-between"><span>GBP/USD</span><span data-market="GBP/USD">--</span></div>
        <div class="flex justify-between"><span>USD/JPY</span><span data-market="USD/JPY">--</span></div>
        <div class="flex justify-between"><span>USD/KES</span><span data-market="USD/KES">--</span></div>
      </div>
    </div>

    <!-- Account Info -->
    <div class="bg-gray-800 rounded-2xl p-4 space-y-1 text-sm">
      <h3 class="text-lg font-semibold mb-2">Account Summary</h3>
      <p id="equity">Equity: $1000.00</p>
      <p id="used-margin">Used Margin: $100.00</p>
      <p id="free-margin">Free Margin: $900.00</p>
      <p id="pnl">P&L: <span class="text-green-300">0.00</span></p>
    </div>

    <!-- Open Trades -->
    <div class="bg-gray-800 rounded-2xl p-4">
      <div class="flex justify-between items-center mb-2">
        <h3 class="text-lg font-semibold">Open Trades</h3>
      </div>
      <div id="open-trades" class="space-y-2 text-sm">
        <!-- Dynamic trades appear here -->
      </div>
    </div>

    <!-- Activity Log -->
    <div class="bg-gray-800 rounded-2xl p-4">
      <div class="flex justify-between items-center mb-2">
        <h3 class="text-lg font-semibold">Recent activity</h3>
      </div>
      <div class="space-y-4">
        <div class="flex justify-between items-center bg-gray-700 p-4 rounded-xl mb-2">
          <div class="flex items-center space-x-3">
            <div class="bg-blue-500 p-2 rounded-full">ðŸ“¦</div>
            <div><h4 class="font-medium">Reward</h4><span class="text-xs text-gray-400">8 hr ago</span></div>
          </div>
          <span class="text-green-400">+$0.01</span>
        </div>
        <!-- Add more rewards if needed -->
      </div>
    </div>
  </div>

  <!-- DYNAMIC SCRIPT -->
  <script>
    const pairs = ["EUR/USD", "GBP/USD", "USD/JPY", "USD/KES"];
    const prices = {};
    const trades = [];
    let balance = 1000;
    let usedMargin = 100;
    let pnl = 0;

    function formatNum(num) {
      return parseFloat(num).toFixed(4);
    }

    async function fetchPrices() {
      const symbols = {
        "EUR/USD": "EUR/USD",
        "GBP/USD": "GBP/USD",
        "USD/JPY": "USD/JPY",
        "USD/KES": "USD/KES"
      };
      const apiKey = "fa443b33e32c49e1b03c0be6d9699b1c";

      for (const pair in symbols) {
        const url = `https://api.twelvedata.com/price?symbol=${symbols[pair]}&apikey=${apiKey}`;
        const res = await fetch(url);
        const data = await res.json();
        prices[pair] = parseFloat(data.price);
      }

      updatePrices();
      updateTrades();
      updateAccount();
    }

    function updatePrices() {
      document.querySelectorAll("[data-market]").forEach(el => {
        const pair = el.getAttribute("data-market");
        if (prices[pair]) el.textContent = formatNum(prices[pair]);
      });
    }

    function updateTrades() {
      let openTradeList = document.querySelector("#open-trades");
      openTradeList.innerHTML = "";
      pnl = 0;

      trades.forEach((trade, index) => {
        const currentPrice = prices[trade.pair];
        if (!currentPrice) return;

        const movement = trade.type === "Buy"
          ? (currentPrice - trade.entry)
          : (trade.entry - currentPrice);

        const tradePnl = movement * 100000 * trade.lotSize;
        pnl += tradePnl;

        const item = document.createElement("div");
        item.className = "bg-gray-700 p-3 rounded-xl flex justify-between items-center text-sm";
        item.innerHTML = `
          <div>
            <p>${trade.pair} - ${trade.type}</p>
            <p class="text-xs text-gray-400">Lot: ${trade.lotSize} | P&L: <span class="${tradePnl >= 0 ? 'text-green-400' : 'text-red-400'}">${tradePnl.toFixed(2)}</span></p>
          </div>
          <button onclick="closeTrade(${index})" class="bg-red-500 text-white text-xs px-2 py-1 rounded">Close</button>
        `;
        openTradeList.appendChild(item);
      });
    }

    function updateAccount() {
      const equity = balance + pnl;
      const freeMargin = equity - usedMargin;

      document.querySelector("#balance").textContent = "$" + balance.toFixed(2);
      document.querySelector("#equity").textContent = "Equity: $" + equity.toFixed(2);
      document.querySelector("#free-margin").textContent = "Free Margin: $" + freeMargin.toFixed(2);
      document.querySelector("#used-margin").textContent = "Used Margin: $" + usedMargin.toFixed(2);
      document.querySelector("#pnl").innerHTML = "P&L: <span class='" + (pnl >= 0 ? "text-green-300" : "text-red-300") + "'>" + pnl.toFixed(2) + "</span>";
    }

    function openTrade(type) {
      const pair = document.querySelector("select").value;
      const lotSize = parseFloat(document.querySelector("input[type='number']").value) || 0.1;
      const entry = prices[pair] || 0;

      if (!entry) return alert("Price not loaded yet.");
      trades.push({ pair, type, lotSize, entry });
      usedMargin += 50;
      updateTrades();
      updateAccount();
    }

    function closeTrade(index) {
      trades.splice(index, 1);
      usedMargin -= 50;
      updateTrades();
      updateAccount();
    }

    document.querySelector(".bg-green-600 button:nth-child(1)").addEventListener("click", () => {
      balance += 100;
      updateAccount();
    });

    document.querySelector(".bg-green-600 button:nth-child(2)").addEventListener("click", () => {
      balance -= 100;
      updateAccount();
    });

    document.querySelector(".bg-green-600 ~ .bg-blue-600 + .bg-gray-800 button.bg-green-600").addEventListener("click", () => openTrade("Buy"));
    document.querySelector(".bg-green-600 ~ .bg-blue-600 + .bg-gray-800 button.bg-red-600").addEventListener("click", () => openTrade("Sell"));

    setInterval(fetchPrices, 5000);
    fetchPrices();
  </script>
</body>
</html>
