<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Forex Trading Demo</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .scrollable-table {
      max-height: 200px;
      overflow-y: auto;
    }
  </style>
</head>
<body class="bg-gray-100 font-sans p-4">
  <!-- Account Overview -->
  <div class="bg-white rounded-2xl shadow p-4 mb-4 grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
    <div><strong>Balance:</strong> $<span id="balance">10000</span></div>
    <div><strong>Equity:</strong> $<span id="equity">10000</span></div>
    <div><strong>Free Margin:</strong> $<span id="margin">10000</span></div>
    <div><strong>P/L:</strong> $<span id="pl">0</span></div>
  </div>

  <!-- TradingView Chart -->
  <div class="mb-4">
    <iframe src="https://s.tradingview.com/widgetembed/?frameElementId=tradingview_7c28c&symbol=FX:EURUSD&interval=1&hidesidetoolbar=1&symboledit=1&saveimage=1&toolbarbg=f1f3f6&studies=[]&theme=light&style=1&timezone=Etc/UTC&withdateranges=1&hideideas=1&studies_overrides={}&overrides={}" width="100%" height="400" frameborder="0"></iframe>
  </div>

  <!-- Trade Controls -->
  <div class="bg-white rounded-2xl shadow p-4 mb-4 flex flex-col md:flex-row gap-2 items-center">
    <label for="lot" class="mr-2">Lot Size:</label>
    <input id="lot" type="number" class="border rounded px-2 py-1 w-24" value="1" min="0.01" step="0.01" />
    <button onclick="openTrade('buy')" class="bg-green-500 text-white px-4 py-2 rounded-xl shadow hover:bg-green-600">Buy</button>
    <button onclick="openTrade('sell')" class="bg-red-500 text-white px-4 py-2 rounded-xl shadow hover:bg-red-600">Sell</button>
  </div>

  <!-- Open Trades -->
  <div class="bg-white rounded-2xl shadow p-4 mb-4">
    <h2 class="text-lg font-bold mb-2">Open Trades</h2>
    <div class="scrollable-table">
      <table class="w-full text-sm text-left">
        <thead>
          <tr>
            <th>Type</th>
            <th>Lot</th>
            <th>Entry</th>
            <th>Current</th>
            <th>P/L</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="openTrades"></tbody>
      </table>
    </div>
  </div>

  <!-- Trade History -->
  <div class="bg-white rounded-2xl shadow p-4">
    <h2 class="text-lg font-bold mb-2">Trade History</h2>
    <div class="scrollable-table">
      <table class="w-full text-sm text-left">
        <thead>
          <tr>
            <th>Type</th>
            <th>Lot</th>
            <th>Entry</th>
            <th>Exit</th>
            <th>P/L</th>
          </tr>
        </thead>
        <tbody id="tradeHistory"></tbody>
      </table>
    </div>
  </div>

  <script>
    let balance = 10000;
    let trades = [];
    let currentPrice = 1.0850;

    function updateUI() {
      const openTrades = document.getElementById("openTrades");
      const tradeHistory = document.getElementById("tradeHistory");
      openTrades.innerHTML = "";
      let pl = 0;

      trades.filter(t => !t.closed).forEach((trade, i) => {
        const diff = (currentPrice - trade.entry) * (trade.type === 'buy' ? 1 : -1);
        const profit = diff * trade.lot * 100000;
        pl += profit;
        trade.currentPrice = currentPrice;
        trade.profit = profit;

        openTrades.innerHTML += `
          <tr>
            <td>${trade.type}</td>
            <td>${trade.lot}</td>
            <td>${trade.entry.toFixed(5)}</td>
            <td>${currentPrice.toFixed(5)}</td>
            <td class="${profit >= 0 ? 'text-green-600' : 'text-red-600'}">${profit.toFixed(2)}</td>
            <td><button onclick="closeTrade(${i})" class="text-blue-600">Close</button></td>
          </tr>
        `;
      });

      document.getElementById("pl").innerText = pl.toFixed(2);
      document.getElementById("equity").innerText = (balance + pl).toFixed(2);
      document.getElementById("margin").innerText = (balance + pl).toFixed(2);
      document.getElementById("balance").innerText = balance.toFixed(2);

      // History
      const closed = trades.filter(t => t.closed);
      tradeHistory.innerHTML = "";
      closed.forEach(trade => {
        tradeHistory.innerHTML += `
          <tr>
            <td>${trade.type}</td>
            <td>${trade.lot}</td>
            <td>${trade.entry.toFixed(5)}</td>
            <td>${trade.exit.toFixed(5)}</td>
            <td class="${trade.profit >= 0 ? 'text-green-600' : 'text-red-600'}">${trade.profit.toFixed(2)}</td>
          </tr>
        `;
      });
    }

    function openTrade(type) {
      const lot = parseFloat(document.getElementById("lot").value);
      if (isNaN(lot) || lot <= 0) return alert("Invalid lot size");
      trades.push({ type, lot, entry: currentPrice, closed: false });
      updateUI();
    }

    function closeTrade(index) {
      const trade = trades[index];
      if (!trade || trade.closed) return;
      trade.closed = true;
      trade.exit = currentPrice;
      balance += trade.profit;
      updateUI();
    }

    // Simulate price changes
    setInterval(() => {
      const rnd = (Math.random() - 0.5) * 0.0005;
      currentPrice += rnd;
      updateUI();
    }, 1000);

    updateUI();
  </script>
</body>
</html>
